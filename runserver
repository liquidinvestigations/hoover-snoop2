#!/bin/bash -ex

/wait

if [[ "$DEBUG" == "true" ]]; then
	    # --max-requests 1 \  # poor man's autoreload
	  exec gunicorn --reload \
	    --access-logfile '-' \
	    --error-logfile '-' \
	    --log-level 'info' \
	    --worker-class sync \
	    --workers $THREAD_COUNT \
	    --threads 1 \
	    --max-requests 1 \
	    --keep-alive 60 \
	    --timeout 600 \
	 -b 0.0.0.0:8080 \
	snoop.wsgi:application
else
	exec gunicorn \
	    --error-logfile '-' \
	    --worker-class sync \
	    --workers $THREAD_COUNT \
	    --threads 1 \
	    --max-requests 1 \
	    --keep-alive 60 \
	  --timeout 600 \
	 -b 0.0.0.0:8080 \
	snoop.wsgi:application
fi
